<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Chess Analysis Board - Professional</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- External Libraries -->
  <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="container">
    <!-- Left Section: Board -->
    <div class="board-section">
      <div class="eval-bar-container">
        <div class="eval-bar-black" id="evalBarBlack"></div>
        <div class="eval-bar-white" id="evalBarWhite"></div>
        <div class="eval-number" id="evalNumber">0.0</div>
      </div>
      
      <div class="board-wrapper">
        <div class="player-info" id="blackPlayer">
          <span class="player-name">Black</span>
          <span class="player-accuracy" id="blackAccuracy"></span>
        </div>
        
        <div id="myBoard"></div>
        
        <div class="player-info" id="whitePlayer">
          <span class="player-name">White</span>
          <span class="player-accuracy" id="whiteAccuracy"></span>
        </div>
        
        <!-- Controls -->
        <div class="controls">
          <button id="firstBtn" title="First Move">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M11.5 3L5.5 8l6 5V3z"/>
              <path d="M4 3h1v10H4V3z"/>
            </svg>
          </button>
          <button id="prevBtn" title="Previous Move">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M11.5 3L5.5 8l6 5V3z"/>
            </svg>
          </button>
          <button id="nextBtn" title="Next Move">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M4.5 3l6 5-6 5V3z"/>
            </svg>
          </button>
          <button id="lastBtn" title="Last Move">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M4.5 3l6 5-6 5V3z"/>
              <path d="M11 3h1v10h-1V3z"/>
            </svg>
          </button>
          <button id="flipBtn" title="Flip Board">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 3l4 4H4l4-4zM8 13l-4-4h8l-4 4z"/>
            </svg>
          </button>
          <button id="lockScrollBtn" title="Lock Scroll">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 1a3 3 0 013 3v2h1a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V7a1 1 0 011-1h1V4a3 3 0 013-3zm0 1a2 2 0 00-2 2v2h4V4a2 2 0 00-2-2z"/>
            </svg>
          </button>
          <button id="analyzeBtn" title="Analyze All">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <circle cx="7" cy="7" r="5" stroke="currentColor" fill="none" stroke-width="2"/>
              <path d="M10.5 10.5l3.5 3.5"/>
            </svg>
            <span>Analyze</span>
          </button>
        </div>
        
        <!-- Status Bar -->
        <div class="status-bar" id="statusBar">Ready to analyze</div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <!-- Evaluation Graph -->
        <div class="eval-graph-container">
          <canvas id="evalGraph"></canvas>
        </div>
      </div>
    </div>
    
    <!-- Right Section: PGN & Statistics -->
    <div class="pgn-section">
      <div class="pgn-header">
        <h3>Move List</h3>
        <div class="header-buttons">
          <button class="icon-btn" id="pgnInputBtn" title="Import PGN">
            <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 2v8m0 0l3-3m-3 3L5 7"/>
              <path d="M3 12v1a1 1 0 001 1h8a1 1 0 001-1v-1" stroke="currentColor" fill="none"/>
            </svg>
          </button>
          <button class="icon-btn" id="statsBtn" title="Game Statistics">
            <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
              <rect x="2" y="10" width="3" height="4"/>
              <rect x="6" y="6" width="3" height="8"/>
              <rect x="10" y="3" width="3" height="11"/>
            </svg>
          </button>
          <button class="icon-btn" id="infoBtn" title="Legend">i</button>
        </div>
      </div>
      
      <!-- PGN Table -->
      <div class="pgn-table-container">
        <table class="pgn-table">
          <thead>
            <tr>
              <th>#</th>
              <th>White</th>
              <th>Black</th>
            </tr>
          </thead>
          <tbody id="pgnTableBody">
            <tr>
              <td colspan="3" style="text-align:center; color:#888;">No moves yet</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <!-- Info Modal -->
  <div id="infoModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeInfoModal">&times;</span>
      <h2>Move Annotations</h2>
      <div class="icon-legend">
        <div class="icon-item">
          <svg width="20" height="20"><circle cx="10" cy="10" r="9" fill="#4ade80"/><text x="10" y="15" text-anchor="middle" font-size="14" fill="white" font-weight="bold">‚úì</text></svg>
          <div><strong>Best Move</strong> - Engine's top choice (¬±15cp)</div>
        </div>
        <div class="icon-item">
          <svg width="20" height="20"><circle cx="10" cy="10" r="9" fill="#22c55e"/><text x="10" y="15" text-anchor="middle" font-size="14" fill="white" font-weight="bold">!</text></svg>
          <div><strong>Great Move</strong> - Excellent (15-30cp loss)</div>
        </div>
        <div class="icon-item">
          <svg width="20" height="20"><circle cx="10" cy="10" r="9" fill="#84cc16"/><circle cx="10" cy="10" r="3" fill="white"/></svg>
          <div><strong>Good Move</strong> - Solid (30-60cp loss)</div>
        </div>
        <div class="icon-item">
          <svg width="20" height="20"><circle cx="10" cy="10" r="9" fill="#f59e0b"/><text x="10" y="15" text-anchor="middle" font-size="12" fill="white" font-weight="bold">?!</text></svg>
          <div><strong>Inaccuracy</strong> - Minor mistake (60-150cp)</div>
        </div>
        <div class="icon-item">
          <svg width="20" height="20"><circle cx="10" cy="10" r="9" fill="#f97316"/><text x="10" y="15" text-anchor="middle" font-size="14" fill="white" font-weight="bold">?</text></svg>
          <div><strong>Mistake</strong> - Clear error (150-300cp)</div>
        </div>
        <div class="icon-item">
          <svg width="20" height="20"><circle cx="10" cy="10" r="9" fill="#ef4444"/><text x="10" y="12" text-anchor="middle" font-size="10" fill="white" font-weight="bold">??</text></svg>
          <div><strong>Blunder</strong> - Serious mistake (300+ cp)</div>
        </div>
        <div class="icon-item">
          <svg width="20" height="20"><defs><linearGradient id="brillGrad"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f59e0b"/></linearGradient></defs><circle cx="10" cy="10" r="9" fill="url(#brillGrad)"/><text x="10" y="15" text-anchor="middle" font-size="14" fill="white">‚≠ê</text></svg>
          <div><strong>Brilliant</strong> - Spectacular move with sacrifice</div>
        </div>
        <div class="icon-item">
          <svg width="20" height="20"><rect width="20" height="20" rx="3" fill="#6366f1"/><text x="10" y="15" text-anchor="middle" font-size="14" fill="white">üìñ</text></svg>
          <div><strong>Book Move</strong> - Opening theory</div>
        </div>
      </div>
    </div>
  </div>

  <!-- PGN Input Modal -->
  <div id="pgnModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closePgnModal">&times;</span>
      <h2>Import PGN</h2>
      <textarea class="pgn-input-area" id="pgnInput" placeholder="Paste your PGN here...

Example:
[Event &quot;Game&quot;]
[White &quot;Player1&quot;]
[Black &quot;Player2&quot;]

1. e4 e5 2. Nf3 Nc6..."></textarea>
      <button class="submit-btn" id="submitPgn">Load Game</button>
    </div>
  </div>

  <!-- Statistics Modal -->
  <div id="statsModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeStatsModal">&times;</span>
      <h2>Game Statistics</h2>
      <div id="statsContent">
        <div class="stats-grid">
          <div class="stat-card">
            <h4>White</h4>
            <div class="stat-item">
              <span>Accuracy:</span>
              <span id="whiteAccuracyStat">-</span>
            </div>
            <div class="stat-item">
              <span>ACPL:</span>
              <span id="whiteACPL">-</span>
            </div>
            <div class="stat-item">
              <span>Best Moves:</span>
              <span id="whiteBestMoves">-</span>
            </div>
            <div class="stat-item">
              <span>Inaccuracies:</span>
              <span id="whiteInaccuracies">-</span>
            </div>
            <div class="stat-item">
              <span>Mistakes:</span>
              <span id="whiteMistakes">-</span>
            </div>
            <div class="stat-item">
              <span>Blunders:</span>
              <span id="whiteBlunders">-</span>
            </div>
          </div>
          
          <div class="stat-card">
            <h4>Black</h4>
            <div class="stat-item">
              <span>Accuracy:</span>
              <span id="blackAccuracyStat">-</span>
            </div>
            <div class="stat-item">
              <span>ACPL:</span>
              <span id="blackACPL">-</span>
            </div>
            <div class="stat-item">
              <span>Best Moves:</span>
              <span id="blackBestMoves">-</span>
            </div>
            <div class="stat-item">
              <span>Inaccuracies:</span>
              <span id="blackInaccuracies">-</span>
            </div>
            <div class="stat-item">
              <span>Mistakes:</span>
              <span id="blackMistakes">-</span>
            </div>
            <div class="stat-item">
              <span>Blunders:</span>
              <span id="blackBlunders">-</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Audio Elements -->
  <audio id="moveSound" src="sounds/move.mp3"></audio>
  <audio id="captureSound" src="sounds/capture.mp3"></audio>
  <audio id="promoteSound" src="sounds/promote.mp3"></audio>
  <audio id="castlingSound" src="sounds/castling.mp3"></audio>
  <audio id="checkSound" src="sounds/check.mp3"></audio>
  <audio id="checkmateSound" src="sounds/checkmate.mp3"></audio>
  <audio id="incorrectMoveSound" src="sounds/incorrect-move.mp3"></audio>

  <!-- External Scripts (LOAD ORDER IMPORTANT!) -->
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="js/chess.js"></script>

  <!-- Application Scripts (EXACT ORDER!) -->
  <script src="js/config.js"></script>
  <script src="js/pieceResolver.js"></script>
  <script src="js/stockfishEngine.js"></script>
  <script src="js/moveClassifier.js"></script>
  <script src="js/moveAnalyzer.js"></script>
  <script src="js/boardManager.js"></script>
  <script src="js/pgnManager.js"></script>
  <script src="js/uiManager.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
